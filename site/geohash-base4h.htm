<!DOCTYPE html>
<html>
<head>
	<title>CLP Viewer</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css"/>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css" crossorigin=""
	  integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
	/>
	<style>
		p, fieldset {margin-left: 10pt;}
		.selected_text {font-weight: bold;}
		.city-PTS span {margin:0;padding:0;}
	</style>

	<script src="http://code.jquery.com/jquery-3.0.0.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/big-integer/1.6.40/BigInteger.min.js"></script>
	<script src="https://npmcdn.com/@turf/turf@5.1.6/turf.min.js"></script>
	<script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js" crossorigin=""
	    integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
	></script>
  <script src="http://lab.digital-democracy.org/leaflet-bing-layer/leaflet-bing-layer.js"></script>

	<script src="./assets/lib_Geocode.js"></script>
	<script src="./assets/libDggCell_Geohash.js"></script>
	<script src="./assets/domPage.js"></script>

<script>

var selectedByUrl = '';

$(document).ready(function() {  //  ONLOAD

    
	Geocode.cf_hash_baseAlphabetLabel='js';
	Geocode.cf_digSepRegex = /([^\+\-\.,;]{5})/g;
	Geocode.kx_hash_baseAlphabet = '0123'; // base4
	Geocode.kx_hash_base = Geocode.kx_hash_baseAlphabet.length;	//4
	Geocode.kx_hash_baseAlphabet_case = false;
	Geocode.kx_hash_baseBits = 2;
	Geocode.kx_halfLevel_isValid = true;


		Geocode.dggCell = DGGcell; // inicializa.
	  //  fazer o mesmo com Cover ou suas CoverCell
	  Geocode.cleanStates();
		if (Geocode.kx_hash_base==4)
			$('#showBase4').hide();

		$('#ptclick_text').css('font-weight', 'bold');
		$( "#ptclick" ).click(function() {
	     if( $(this).is(':checked') ) {
	       $('#zoomIn_text').css('font-weight', 'bold');
	       $('#ptclick_text').css('font-weight', 'normal');
	     } else {
	       $('#zoomIn_text').css('font-weight', 'normal');
	       $('#ptclick_text').css('font-weight', 'bold');
	     }
		});

		$('#dom_geocode').change( function() {
			var c = Geocode.setByHash_whenIsValid( $('#dom_geocode').val() );
			if (c) {
				$('#dom_level').val(c.level)
				setRefPoint(c.center);
			} // gambi, calcula hash novamente
			else console.log("interface ERROR: invalid geocode");
		});

		$('#dom_latlon').change( function() {
			// editing lat or lon, refresh all.
			var c = dom_getLatLon();
			if (c) setRefPoint(c);
		});

		$('#dom_level').change( function() {
			var c = dom_getLatLon();
			if (c) setRefPoint(c);
		});

		$('#code_sep').change( function() {
			Geocode.cf_hash_sep = $(this).is(':checked')?  '.':  ''; // for next
			$('#dom_geocode').val(
				Geocode.hashRender( $('#dom_geocode').val(), true )
			);
		});

		runRequest() // checks URL and run parsed parameters.

}); //ONLOAD
</script>
</head>

<body>

<p>Localize com geocódigos!
	&nbsp;
	<a target="_blank" href="http://www.openstreetmap.com.br/CLP/site/index_CLPcoord/#comparando-candidatos">Grade selecionada</a>:
	<b>Geohash com base4h</b>. Clique no mapa ou ...
	&nbsp;
	<select id="usetec" onchange="if (this.value) window.open(this.value+'.htm','_self',false);">
	<option value="" selected>-- Selecione outra grade --</option>
	
	<option value='geohash-base32ghs'>Geohash padrão (base32ghs)</option>
	<option value='geohash-base32pt'>Geohash com base32pt</option>
	<option value='geohash-base16h'>Geohash com base16h</option>
	<option value='geohash-base4'>Geohash com base4</option>
	<option value='plusCode'>OLC (grade do PlusCode)</option>
	</select>
</p>

<div id="mapid" style="width: 100%; height: 400px;"></div>
<script src="assets/map.js"></script>

<p>
	Zoom <span id="zoom_val">16</span>:
	&nbsp; &nbsp;
	<label title="Ativa click de pega-ponto no mapa, ou zoom-in onClick">
	  <input type="checkbox" id="ptclick"/>
	  <i id="zoomIn_text">double-click zoom-in</i>
	</label>
	&nbsp;
	(or <span id="ptclick_text">click-point</span>
	&nbsp;&nbsp;&nbsp;&nbsp;<label title="Zoom-fit to the cell">
	    <input type="checkbox" id="fitZoom" checked="1">
	    <i>fit zoom to cell</i></label>).
	&nbsp; &nbsp;
	<span title="geoURI (latitude e longitude) do mouse quando apontando posição sobre o mapa"
	      style="white-space:nowrap;font-family:monospace">geo:<span id="showMouseMove">?</span></span>
</p>

<form><!-- remover tag form -->
	<fieldset><legend>Célula <b>Geohash com base4h</b></legend>
		<label style="white-space:nowrap">Geocódigo:
			<input type="text" size="29" id="dom_geocode" style="font-weight: bold; color:#008; font-size:135%;"/></label>
		  (<span id="dom_geocode_digits" style="font-family:monospace;color:#008">0</span><small> dígitos</small>) &nbsp;&nbsp;&nbsp;
		<label style="white-space:nowrap">Separadores <input type="checkbox" checked="1" id="code_sep"/></label>
		&nbsp;&nbsp;&nbsp;
		<label style="white-space:nowrap">Nível hierárquico:
			<select id="dom_level" class="latlon" style="font-weight: bold; color:#008; font-size:135%;">
			
	<option value='2'>L2</option>
	<option value='2.5'>L2½</option>
	<option value='3'>L3</option>
	<option value='3.5'>L3½</option>
	<option value='4'>L4 (~1100km)</option>
	<option value='4.5'>L4½</option>
	<option value='5'>L5 (~800km)</option>
	<option value='5.5'>L5½</option>
	<option value='6'>L6 (~600km)</option>
	<option value='6.5'>L6½</option>
	<option value='7'>L7</option>
	<option value='7.5'>L7½ (~150km)</option>
	<option value='8'>L8</option>
	<option value='8.5'>L8½</option>
	<option value='9'>L9</option>
	<option value='9.5'>L9½</option>
	<option value='10'>L10 (~30km)</option>
	<option value='10.5'>L10½</option>
	<option value='11'>L11</option>
	<option value='11.5'>L11½</option>
	<option value='12'>L12</option>
	<option value='12.5'>L12½</option>
	<option value='13'>L13</option>
	<option value='13.5'>L13½</option>
	<option value='14'>L14</option>
	<option value='14.5'>L14½</option>
	<option value='15'>L15 (~1km)</option>
	<option value='15.5'>L15½</option>
	<option value='16'>L16 (~500m)</option>
	<option value='16.5'>L16½</option>
	<option value='17'>L17</option>
	<option value='17.5'>L17½</option>
	<option value='18' selected>L18</option>
	<option value='18.5'>L18½</option>
	<option value='19'>L19</option>
	<option value='19.5'>L19½</option>
	<option value='20'>L20 (~30m)</option>
	<option value='20.5'>L20½</option>
	<option value='21'>L21</option>
	<option value='21.5'>L21½</option>
	<option value='22'>L22 (~10m)</option>
	<option value='22.5'>L22½ (~5m)</option>
	<option value='23'>L23</option>
	<option value='23.5'>L23½</option>
	<option value='24'>L24</option>
			</select></label>
		<br/>
		<label>Centro em <span style="white-space:nowrap; font-family:monospace">geo:<input
			type="text" title="Latitude (°N/S), Longitude (°L/O)"
			id="dom_latlon" size="22" maxlength="26" class="latlon" placeholder="GeoURI"/></span>
		</label>
		&nbsp;&nbsp;&nbsp;
		<label id="showBase4" style="white-space:nowrap;">Base4:
			<span id="dom_base4" style="font-family:monospace;color:#888"></span></label>
	</fieldset>

<!-- outr fieldset -->

	<div id="city-ALL">
		<p class="city-LST">Cidade com bordas apresentadas em vermelho:
		&nbsp;<a href="javascript:void(0);" onclick="cityCanvas.show('sp-spa','city')" id="city-sp-spa">São Paulo (SP)</a>,
		<!-- mostrar amarelo claro ... Cover-set Geohash de "sp-spa"  = ['6gwx','6gwz', '6gy8','6gy9','6gyb','6gyc','6gyd','6gyf','6gyg',  '6gz1','6gz4'] -->
		&nbsp;<a href="javascript:void(0);" onclick="cityCanvas.show('pr-cur','city')" id="city-pr-cur">Curitiba (PR)</a>.
		</p>
		<p class="city-PTS">Pontos de controle na cidade selecionada: <span>(clique em cidade)</span>
			<span id="city-PTS-sp-spa" style="display:none">
		   <a href="javascript:void(0);" onclick="setRefPoint(-23.561618,-46.655996);">MASP</a>,
		   <a href="javascript:void(0);" onclick="setRefPoint(-23.550375,-46.633937);">Marco-zero-SP</a>, ...
		  </span>
			<span id="city-PTS-pr-cur" style="display:none">
		   <a href="javascript:void(0);" onclick="setRefPoint(-25.48656,-49.2744);">ponto-lixo1</a>,
		   <a href="javascript:void(0);" onclick="setRefPoint(-25.63145,-49.3595);">ponto-lixo2</a>, ...
		  </span>
		</p>
</div>

</form>


</body>
</html>